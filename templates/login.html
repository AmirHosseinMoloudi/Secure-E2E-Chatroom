{% extends "base.html" %} {% block title %}Login - Secure Chat{% endblock %} {%
block content %}
<div
  class="container d-flex align-items-center justify-content-center min-vh-100"
>
  <div class="secure-container">
    <div class="text-center mb-4">
      <i class="fas fa-shield-alt fa-3x text-primary mb-3"></i>
      <h2 class="fw-bold">Secure Chat</h2>
      <p class="text-muted">End-to-End Encrypted Messaging</p>
    </div>

    <form id="loginForm">
      <div class="mb-3">
        <label for="username" class="form-label">
          <i class="fas fa-user me-2"></i>Username
        </label>
        <input
          type="text"
          class="form-control secure-input"
          id="username"
          placeholder="Enter your username"
          required
        />
      </div>

      <div class="mb-3">
        <label for="password" class="form-label">
          <i class="fas fa-lock me-2"></i>Password
        </label>
        <input
          type="password"
          class="form-control secure-input"
          id="password"
          placeholder="Enter your password"
          required
        />
      </div>

      <div class="mb-3 form-check">
        <input type="checkbox" class="form-check-input" id="rememberMe" />
        <label class="form-check-label" for="rememberMe"> Remember me </label>
      </div>

      <button type="submit" class="btn secure-btn w-100 mb-3">
        <i class="fas fa-sign-in-alt me-2"></i>
        Login Securely
      </button>
    </form>

    <div class="text-center">
      <p class="mb-0">Don't have an account?</p>
      <a href="{{ url_for('register') }}" class="text-decoration-none">
        <i class="fas fa-user-plus me-1"></i>Create Account
      </a>
    </div>

    <div class="mt-4 text-center">
      <small class="text-muted">
        <i class="fas fa-info-circle me-1"></i>
        All communications are protected with AES-256 encryption
      </small>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  document
    .getElementById("loginForm")
    .addEventListener("submit", async function (e) {
      e.preventDefault();

      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;

      if (!username || !password) {
        showAlert("Please fill in all fields", "danger");
        return;
      }

      const submitBtn = document.querySelector('button[type="submit"]');
      const originalText = submitBtn.innerHTML;
      submitBtn.innerHTML =
        '<i class="fas fa-spinner fa-spin me-2"></i>Authenticating...';
      submitBtn.disabled = true;

      try {
        const response = await fetch("/login", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            username: username,
            password: password,
          }),
        });

        const data = await response.json();

        if (data.success) {
          showAlert("Login successful! Redirecting...", "success");
          setTimeout(() => {
            window.location.href = data.redirect;
          }, 1000);
        } else {
          showAlert(data.message || "Login failed", "danger");
        }
      } catch (error) {
        showAlert("Network error. Please try again.", "danger");
      } finally {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
      }
    });

  // Auto-focus username field
  document.getElementById("username").focus();
</script>
{% endblock %}
